{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="row" style="justify-content:space-between; align-items:center;">
    <h3 style="margin:0;">–ó–∞–∫–∞–∑—ã</h3>
    <form method="get" class="row" style="gap:8px;">
      <input type="text" name="q" value="{{ query or '' }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ TG ID" style="width:220px;" />
      <button class="btn">–ò—Å–∫–∞—Ç—å</button>
    </form>
  </div>
  <form method="post" action="/admin/orders/delete" class="row" style="gap:8px; margin-top:8px;">
    <input type="number" name="order_id" placeholder="ID –∑–∞–∫–∞–∑–∞" style="width:160px;" required />
    <button class="btn btn-danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?');">–£–¥–∞–ª–∏—Ç—å –ø–æ ID</button>
  </form>
  <table style="margin-top:16px;">
    <thead>
      <tr>
        <th>ID</th>
        <th>–¢–æ–≤–∞—Ä</th>
        <th>–°—É–º–º–∞</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å TG</th>
        <th style="text-align:right;">–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
      {% for o in orders %}
      <tr>
        <td>{{ o.id }}</td>
        <td>{{ o.item_id }}</td>
        <td>{{ '%.2f' % (o.amount_minor/100) }} ‚ÇΩ</td>
        <td>{{ o.status.value if o.status else o.status }}</td>
        <td>{{ o.buyer_tg_id or '' }}</td>
        <td style="text-align:right;">
          <form method="post" action="/admin/orders/{{ o.id }}/delete" style="display:inline;">
            <button type="submit" class="btn btn-danger btn-icon" title="–£–¥–∞–ª–∏—Ç—å" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ #{{ o.id }}?');">üóëÔ∏è</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="row" style="justify-content:space-between; margin-top:12px;">
    <div style="color:#9aa4b2; font-size:12px;">–í—Å–µ–≥–æ: {{ total }}</div>
    <div class="row" style="gap:8px;">
      {% set prev = page-1 %}
      {% set next = page+1 %}
      {% if page > 1 %}
        <a class="btn" href="/admin/orders?page={{ prev }}{% if query %}&q={{ query }}{% endif %}">–ù–∞–∑–∞–¥</a>
      {% endif %}
      {% if page*page_size < total %}
        <a class="btn" href="/admin/orders?page={{ next }}{% if query %}&q={{ query }}{% endif %}">–í–ø–µ—Ä—ë–¥</a>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
